<?xml version="1.0" encoding="UTF-8" ?>    
    <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >    
    <mapper namespace="com.ssm.dao.IAdminDao" >      
       
        <sql id="base_admin" >
	       userid id,usercode,username name,password pass,avatar,loginip ,lastlogintime,loginaddress,registertime,salt,locked
	    </sql>
        <sql id="base_role" >
           role_id,role_code,role_name,role_description,role_createtime
        </sql>
        <sql id="base_permission" >
            sys_permission.id,
            sys_permission.name,
            sys_permission.icon,
            sys_permission.type,
            sys_permission.url,
            sys_permission.percode,
            sys_permission.parentid,
            sys_permission.parentids,
            sys_permission.sortstring,
            sys_permission.available
        </sql>

       
        <select id="selectAdmin" resultType="com.ssm.dto.Admin" parameterType="String">
           
          select  <include refid="base_admin"/> from sys_admins where username=#{username} and locked=0
        
        </select>
        <insert id="saveAdmin" parameterType="com.ssm.dto.Admin" useGeneratedKeys="true" keyProperty="id">
            insert into  <include refid="base_admin"/>
            values(#{id},#{usercode},#{name},#{pass},#{avatar},#{loginip},#{lastlogintime},#{loginaddress},#{registertime},#{salt},#{locked})

        </insert>
        <!--查询所有管理员-->
        <select id="selectAllAdmins" resultType="com.ssm.dto.Admin" >
            select  <include refid="base_admin"/> from sys_admins
        </select>
        <!--查询所有角色-->
        <select id="selectAllRoles" resultType="com.ssm.dto.Sys_Role" >
            select  <include refid="base_role"/> from sys_roles
        </select>
        <!--查询所有权限-->
        <select id="selectAllPers" resultType="com.ssm.dto.Sys_Pers" >
            select  <include refid="base_permission"/> from sys_permission
        </select>

        <!--查询用户拥有的角色-->
        <select id="selectRolesByAdminId" resultType="com.ssm.dto.Sys_Role" parameterType="Integer" >
            select  role_id,role_code,role_name,role_description,role_createtime from sys_roles
            where role_id in(select role_id from sys_admin_role where admin_id=#{adminid})
        </select>

        <!--查询角色所拥有的权限-->
        <select id="selectPersByRoleId" resultType="com.ssm.dto.Sys_Pers" parameterType="Integer" >
            select  <include refid="base_permission"/> from sys_permission
            where id in(select role_permission from sys_role_permission where role_id=#{roleid})
        </select>

    </mapper>    
